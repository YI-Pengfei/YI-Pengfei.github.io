<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://YI-Pengfei.github.io</id>
    <title>飞天小南鲸</title>
    <updated>2020-03-01T01:16:47.871Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://YI-Pengfei.github.io"/>
    <link rel="self" href="https://YI-Pengfei.github.io/atom.xml"/>
    <subtitle>记得戴口罩</subtitle>
    <logo>https://YI-Pengfei.github.io/images/avatar.png</logo>
    <icon>https://YI-Pengfei.github.io/favicon.ico</icon>
    <rights>All rights reserved 2020, 飞天小南鲸</rights>
    <entry>
        <title type="html"><![CDATA[智能优化算法]]></title>
        <id>https://YI-Pengfei.github.io/post/zhi-neng-you-hua-suan-fa/</id>
        <link href="https://YI-Pengfei.github.io/post/zhi-neng-you-hua-suan-fa/">
        </link>
        <updated>2020-03-01T01:11:22.000Z</updated>
        <content type="html"><![CDATA[<p><a href="https://blog.csdn.net/Frank_LJiang/article/details/90949775">https://blog.csdn.net/Frank_LJiang/article/details/90949775</a><br>
<a href="https://blog.csdn.net/Sinde1992/article/details/50321225">https://blog.csdn.net/Sinde1992/article/details/50321225</a></p>
<h3 id="进化类算法">进化类算法：</h3>
<ul>
<li>遗传算法、差分进化算法</li>
<li>免疫算法</li>
</ul>
<h3 id="群智能算法">群智能算法</h3>
<ul>
<li>蚁群算法  1992年</li>
<li>粒子群优化算法  1995年</li>
</ul>
<h3 id="模拟退火算法">模拟退火算法</h3>
<h3 id="禁忌搜索算法">禁忌搜索算法</h3>
<h3 id="神经网络算法">神经网络算法</h3>
<p>为了找出地球上最高的山，一群兔子开始想办法</p>
<ol>
<li>兔子朝着比现在高的地方跳去。他们找到了不远处的最高山峰。但是这座山不一定是珠穆朗玛峰。这就是<strong>局部搜索</strong>，它不能保证局部最优值就是全局最优值。</li>
<li>兔子喝醉了。他随机地跳了很长时间。这期间，它可能走向高处，也可能踏入平地。但是，他渐渐清醒了并朝最高方向跳去。这就是<strong>模拟退火</strong>。</li>
<li>兔子们吃了失忆药片，并被发射到太空，然后随机落到了地球上的某些地方。他们不知道自己的使命是什么。但是，如果你过几年就杀死一部分海拔低的兔子，多产的兔子们自己就会找到珠穆朗玛峰。这就是<strong>遗传算法</strong>。</li>
</ol>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Python画图 三维]]></title>
        <id>https://YI-Pengfei.github.io/post/python-hua-tu-san-wei/</id>
        <link href="https://YI-Pengfei.github.io/post/python-hua-tu-san-wei/">
        </link>
        <updated>2020-02-27T23:16:14.000Z</updated>
        <content type="html"><![CDATA[<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo>)</mo><mo>=</mo><mn>5</mn><mi>s</mi><mi>i</mi><mi>n</mi><mo>(</mo><mi>x</mi><mi>y</mi><mo>)</mo><mo>+</mo><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">f(x,y)=5sin(xy)+x^2+y^2
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">5</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9474379999999999em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.0585479999999998em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></p>
<pre><code class="language-python">from mpl_toolkits.mplot3d import Axes3D
from matplotlib import cm
import matplotlib.pyplot as plt
import numpy as np
import mpl_toolkits.mplot3d
import math

def func(X):
    x,y=X[0],X[1]
    &quot;&quot;&quot;x,y为两个数值变量&quot;&quot;&quot;
    z = 5*np.sin(x*y)+x**2+y**2
    return z

def plot():
    figure=plt.figure()
    #ax = Axes3D(figure)
    ax=figure.gca(projection=&quot;3d&quot;)
    x1=np.arange(-4,4,0.02)
    y1=np.arange(-4,4,0.02)
    x,y =np.meshgrid(x1,y1)
    z=func([x,y])
    #ax.plot_surface(x,y,z,rstride=10,cstride=4,cmap=cm.YlGnBu_r)
    ax.plot_surface(x,y,z,cmap=&quot;rainbow&quot;)
    plt.show()

plot()
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://YI-Pengfei.github.io/post-images/1582852756703.png" alt="" loading="lazy"></figure>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[应用tflearn实现神经网络-一个简单的例子]]></title>
        <id>https://YI-Pengfei.github.io/post/ying-yong-tflearn-shi-xian-shen-jing-wang-luo-yi-ge-jian-dan-de-li-zi/</id>
        <link href="https://YI-Pengfei.github.io/post/ying-yong-tflearn-shi-xian-shen-jing-wang-luo-yi-ge-jian-dan-de-li-zi/">
        </link>
        <updated>2020-02-21T03:16:47.000Z</updated>
        <content type="html"><![CDATA[<p>tflearn官方文档 <a href="http://tflearn.org/">http://tflearn.org/</a><br>
&quot;&quot;&quot;<br>
练习tensorflow和tflearn<br>
&quot;&quot;&quot;</p>
<pre><code class="language-python">import tensorflow as tf
import tflearn
import numpy as np
import random
from matplotlib import pyplot as plt

tf.reset_default_graph()

def generate_data(n=5, num=1000):
    &quot;&quot;&quot;产生测试用的数据&quot;&quot;&quot;
    d = [0,1]

    allX = []
    allY = []
    for count in range(num):
        lst = []
        label = [0,1]
        for i in range(n):
            rnd = random.choice(d)
            if len(lst)&gt;=1 and rnd==1 and rnd==lst[-1]:
                label = [1,0]   ## 有连续两个1
            lst.append(rnd)
        allX.append(lst)
        allY.append(label)
    ## 随机将数据分为两组，训练组 和 测试组
    allX = np.array(allX)
    allY = np.array(allY)
    trainIndex = sorted(random.sample(list(range(num)), int(num/5)))
    testIndex = sorted(list(set(range(num))- set(trainIndex)))
    trainX, trainY = allX[trainIndex,:], allY[trainIndex ,:]
    testX, testY = allX[testIndex,:], allY[testIndex ,:]

    return trainX, trainY, testX, testY


def train_model(trainX, trainY, acti):
    &quot;&quot;&quot;构建神经网络，训练神经网络&quot;&quot;&quot;
    n_in, n_out = len(trainX[0]), len(trainY[0])
    net = tflearn.input_data(shape=[None, n_in])
    net = tflearn.fully_connected(net, 8, activation=acti)
    net = tflearn.fully_connected(net, 8, activation=acti)
    net = tflearn.fully_connected(net, n_out, activation=acti)
    net = tflearn.regression(net, optimizer='adam', 
                             loss='categorical_crossentropy',
                             learning_rate=0.01)
    
    model = tflearn.DNN(net, tensorboard_verbose=3)
    model.fit(trainX, trainY, n_epoch=100, show_metric=True, batch_size=50)
    return model


def test_model(model, testX, testY):
    &quot;&quot;&quot;测试神经网络&quot;&quot;&quot;
    pred = model.predict(testX)
    n_right=0
    for i,lst in enumerate(pred):
        if lst[0]&gt;lst[1]:
            res = [1,0]
        else:
            res = [0,1]
        if res==testY[i].tolist():
            n_right+=1
        
    accuracy = n_right/len(pred)
    return accuracy


trainX, trainY, testX, testY = generate_data(n=5, num=1000)
model = train_model(trainX, trainY, acti='softmax') # 训练模型
accuracy = test_model(model, testX, testY)
print('Predict accuracy is:%f'%accuracy)
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[关联规则学习 Association rule learning]]></title>
        <id>https://YI-Pengfei.github.io/post/guan-lian-gui-ze-xue-xi-association-rule-learning/</id>
        <link href="https://YI-Pengfei.github.io/post/guan-lian-gui-ze-xue-xi-association-rule-learning/">
        </link>
        <updated>2020-02-21T03:06:05.000Z</updated>
        <content type="html"><![CDATA[<p><a href="http://rasbt.github.io/mlxtend/api_subpackages/mlxtend.frequent_patterns/">http://rasbt.github.io/mlxtend/api_subpackages/mlxtend.frequent_patterns/</a><br>
&quot;&quot;&quot;<br>
关联规则学习 Association rule learning 的目的是从大数据中发现变量之间的相关性<br>
如&quot;啤酒和尿布&quot;的故事<br>
Apriori alogrithm<br>
实现Apriori alogrithm 用 mlxtend.frequent_patterns<br>
&quot;&quot;&quot;</p>
<pre><code class="language-python">import pandas as pd
from mlxtend.frequent_patterns import apriori
from mlxtend.frequent_patterns import association_rules
## 创建数据
columns = ['Milk', 'Bread', 'Butter', 'Beer', 'Diaper']
L_transactions=[[1,1,0,0,0],
                [0,0,1,0,0],
                [0,0,0,1,1],
                [1,1,1,0,0],
                [0,1,0,0,0]]
df = pd.DataFrame(L_transactions, columns=columns)

frequent_itemsets=apriori(df,min_support=0.4)  ## 计算频繁项集 p&gt;0.4
print(frequent_itemsets)

rules = association_rules(frequent_itemsets, metric='confidence', min_threshold=0.5)  ## 求关联规则
print(rules)
</code></pre>
<p>输出：</p>
<pre><code class="language-python">   support itemsets
0      0.4      (0)
1      0.6      (1)
2      0.4      (2)
3      0.4   (0, 1)
  antecedents consequents     ...      leverage  conviction
0         (0)         (1)     ...          0.16         inf
1         (1)         (0)     ...          0.16    1.800000

[2 rows x 9 columns]
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[无监督学习-Kmeans聚类和 层次聚类]]></title>
        <id>https://YI-Pengfei.github.io/post/wu-jian-du-xue-xi-kmeans-ju-lei-he-ceng-ci-ju-lei/</id>
        <link href="https://YI-Pengfei.github.io/post/wu-jian-du-xue-xi-kmeans-ju-lei-he-ceng-ci-ju-lei/">
        </link>
        <updated>2020-02-21T02:18:15.000Z</updated>
        <content type="html"><![CDATA[<p>&quot;&quot;&quot;<br>
Kmeans聚类和 层次聚类<br>
<a href="https://scikit-learn.org/stable/modules/clustering.html#clustering">https://scikit-learn.org/stable/modules/clustering.html#clustering</a><br>
&quot;&quot;&quot;</p>
<pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt
import sklearn.cluster
SIZES,SEED,k,num=20,0,5,2
colors=[&quot;ro&quot;,&quot;b*&quot;,&quot;gs&quot;,&quot;y^&quot;,&quot;kx&quot;]
Algorithms=[&quot;Kmeans&quot;,&quot;Hierarchical-Single&quot;,&quot;Hierarchical-Average&quot;,&quot;Hierarchical-Maximum&quot;]
la=len(Algorithms)
Lx=np.concatenate([np.cos(np.arange(0,np.pi,0.01))*(100+j)/100+np.random.rand(int(np.pi/0.01)+1)*0.05 for j in range(num)]+[np.cos(np.arange(0,np.pi,0.01))*(100+j)/200+np.random.rand(int(np.pi/0.01)+1)*0.05 for j in range(num)])
Ly=np.concatenate([np.sin(np.arange(0,np.pi,0.01))*(100+j)/100+np.random.rand(int(np.pi/0.01)+1)*0.05 for j in range(num)]+[np.sin(np.arange(0,np.pi,0.01))*(100+j)/200+np.random.rand(int(np.pi/0.01)+1)*0.05 for j in range(num)])
n=len(Lx)
c=np.sqrt((Lx-Lx.reshape(n,1))**2+(Ly-Ly.reshape(n,1))**2)  # 为什么这个是目标？？？ 代价函数：误差平方和（SSE）
fig=plt.figure(figsize=(8,4*la))
for i in range(la):
    if Algorithms[i]==&quot;Kmeans&quot;:
        y_pred = sklearn.cluster.KMeans(n_clusters=k,random_state=SEED).fit_predict(list(zip(Lx,Ly)))
    elif Algorithms[i]==&quot;Hierarchical-Single&quot;:
        y_pred = sklearn.cluster.AgglomerativeClustering(linkage=&quot;ward&quot;, n_clusters=k).fit_predict(list(zip(Lx,Ly)))
    elif Algorithms[i]==&quot;Hierarchical-Average&quot;:
        y_pred = sklearn.cluster.AgglomerativeClustering(linkage=&quot;average&quot;, n_clusters=k).fit_predict(list(zip(Lx,Ly)))
    elif Algorithms[i]==&quot;Hierarchical-Maximum&quot;:
        y_pred = sklearn.cluster.AgglomerativeClustering(linkage=&quot;complete&quot;, n_clusters=k).fit_predict(list(zip(Lx,Ly)))

    ax = plt.subplot(la,2,i+1)
    for j in range(n):

        cluster = y_pred[j]
        plt.plot(Lx[j],Ly[j],colors[cluster],markersize=5)

    ax.set_title(Algorithms[i],fontsize=SIZES)
#plt.savefig(&quot;C12Clustering.pdf&quot;,bbox_inches='tight')
#plt.close()
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://YI-Pengfei.github.io/post-images/1582256775343.png" alt="" loading="lazy"></figure>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[leNet5卷积网络]]></title>
        <id>https://YI-Pengfei.github.io/post/lenet5-juan-ji-wang-luo/</id>
        <link href="https://YI-Pengfei.github.io/post/lenet5-juan-ji-wang-luo/">
        </link>
        <updated>2020-02-17T02:13:14.000Z</updated>
        <content type="html"><![CDATA[<p>对mnist数据集训练leNet5卷积网络<br>
<img src="https://YI-Pengfei.github.io/post-images/1581906013166.png" alt="" loading="lazy"></p>
<ul>
<li>mnist_lenet5_forward.py</li>
</ul>
<pre><code class="language-python">import tensorflow as tf
IMAGE_SIZE = 28
NUM_CHANNELS = 1 # 单通道
CONV1_SIZE = 5 # 卷积核尺寸 5*5*1*32
CONV1_KERNEL_NUM = 32 ## 卷积核的个数
CONV2_SIZE = 5
CONV2_KERNEL_NUM = 64
FC_SIZE = 512 # 全连接层 512
OUTPUT_NODE = 10

def get_weight(shape, regularizer):
    &quot;&quot;&quot;权重生成函数
    shape: 生成张量的维度
    regularizer: 正则化权重
    &quot;&quot;&quot;
    w = tf.Variable(tf.truncated_normal(shape, stddev=0.1), dtype=tf.float32) # 创建方法在 3.2节
    if regularizer!=None:  # L2正则化
        tf.add_to_collection('losses', tf.contrib.layers.l2_regularizer(regularizer)(w))
    return w

def get_bias(shape):
    # 生成 偏置
    b = tf.Variable(tf.constant(0.5, shape=shape)) # shape=[11]
    return b

def conv2d(x,w):
    &quot;&quot;&quot;卷积计算函数&quot;&quot;&quot;
    return tf.nn.conv2d(x, # 输入描述 [batch,行分辨率,列分辨率,通道数]
                        w, # 卷积核描述 [行分辨率,列分辨率,通道数,卷积核个数]
                        strides=[1,1,1,1], # 核滑动步长[1,行步长,列步长,1]，
                        padding='SAME'  # 填充模式
                        )

def max_pool_2x2(x):
    &quot;&quot;&quot;最大池化函数&quot;&quot;&quot;
    return tf.nn.max_pool(x, # 输入描述 [batch,行分辨率,列分辨率,通道数]
                          ksize=[1,2,2,1], # 池化核描述[1,行分辨率,列分辨率,1]，
                          strides=[1,2,2,1], # 池化核滑动步长[1,行步长,列步长,1]，
                          padding='SAME' # 填充模式
                          )
    

def forward(x, train, regularizer):
    conv1_w = get_weight([CONV1_SIZE, CONV1_SIZE,NUM_CHANNELS, CONV1_KERNEL_NUM], regularizer)
    conv1_b = get_bias([CONV1_KERNEL_NUM])
    conv1 = conv2d(x, conv1_w)  # 卷积
    relu1 = tf.nn.relu(tf.nn.bias_add(conv1, conv1_b)) # 加偏置
    pool1 = max_pool_2x2(relu1)  # 最大池化
    
    conv2_w = get_weight([CONV2_SIZE, CONV2_SIZE, CONV1_KERNEL_NUM, CONV2_KERNEL_NUM], regularizer)
    conv2_b = get_bias([CONV2_KERNEL_NUM])
    conv2 = conv2d(pool1, conv2_w)
    relu2 = tf.nn.relu(tf.nn.bias_add(conv2, conv2_b))
    pool2 = max_pool_2x2(relu2)
    
    pool_shape = pool2.get_shape().as_list()
    nodes = pool_shape[1]*pool_shape[2]*pool_shape[3]  # 特征的长度*宽度*深度
    reshaped = tf.reshape(pool2, [pool_shape[0], nodes])  # pool_shape[0] 是一个BATCH的值
    
    fc1_w = get_weight([nodes, FC_SIZE], regularizer)
    fc1_b = get_bias([FC_SIZE])
    fc1 = tf.nn.relu(tf.matmul(reshaped, fc1_w) + fc1_b)
    if train: # 训练时使用dropout
        fc1 = tf.nn.dropout(fc1, 0.5)
    
    fc2_w = get_weight([FC_SIZE, OUTPUT_NODE], regularizer)
    fc2_b = get_bias([OUTPUT_NODE])
    y = tf.matmul(fc1, fc2_w)+fc2_b
    return y
</code></pre>
<ul>
<li>mnist_lenet5_backward.py</li>
</ul>
<pre><code class="language-python"># -*- coding: utf-8 -*-
&quot;&quot;&quot;
Created on Mon Feb 17 08:56:24 2020

@author: y1064
&quot;&quot;&quot;

import tensorflow as tf
from tensorflow.examples.tutorials.mnist import input_data
import mnist_lenet5_forward
import os
import numpy as np

BATCH_SIZE = 100
LEARNING_RATE_BASE = 0.005
LEARNING_RATE_DECAY = 0.99
REGULARIZER = 0.0001
STEPS = 50000
MOVING_AVERAGE_DECAY = 0.99
MODEL_SAVE_PATH = 'model/'
MODEL_NAME = 'mnist_model'

def backward(mnist):
    x = tf.placeholder(tf.float32,  ## 输入是四阶张量
                       [
                        BATCH_SIZE,
                        mnist_lenet5_forward.IMAGE_SIZE,
                        mnist_lenet5_forward.IMAGE_SIZE,
                        mnist_lenet5_forward.NUM_CHANNELS
                               ])
    y_ = tf.placeholder(tf.float32, 
                        [None, mnist_lenet5_forward.OUTPUT_NODE])
    y = mnist_lenet5_forward.forward(x, True, REGULARIZER)
    global_step = tf.Variable(0, trainable=False)
    
    ce = tf.nn.sparse_softmax_cross_entropy_with_logits(
            logits=y, labels=tf.argmax(y_, 1))
    cem = tf.reduce_mean(ce)
    loss = cem + tf.add_n(tf.get_collection('losses'))
    
    learning_rate = tf.train.exponential_decay(
            LEARNING_RATE_BASE,
            global_step,
            mnist.train.num_examples/BATCH_SIZE,
            LEARNING_RATE_DECAY,
            staircase = True)
    
    train_step = tf.train.GradientDescentOptimizer(
            learning_rate).minimize(loss, global_step=global_step)
    
    ema = tf.train.ExponentialMovingAverage(
            MOVING_AVERAGE_DECAY, global_step)
    ema_op = ema.apply(tf.trainable_variables())
    with tf.control_dependencies([train_step, ema_op]):
        train_op = tf.no_op(name='train')
    
    saver = tf.train.Saver()
    
    with tf.Session() as sess:
        init_op = tf.global_variables_initializer()
        sess.run(init_op)
        
        ckpt = tf.train.get_checkpoint_state(MODEL_SAVE_PATH)
        if ckpt and ckpt.model_checkpoint_path:
            saver.restore(sess, ckpt.model_checkpoint_path)
        
        for i in range(STEPS):
            xs, ys = mnist.train.next_batch(BATCH_SIZE)
            ## 这样reshape就能变成四阶张量？？、
            reshaped_xs = np.reshape(xs, (
                        BATCH_SIZE,
                        mnist_lenet5_forward.IMAGE_SIZE,
                        mnist_lenet5_forward.IMAGE_SIZE,
                        mnist_lenet5_forward.NUM_CHANNELS))
            _, loss_value, step = sess.run([train_op, loss, global_step],
                                           feed_dict={x:reshaped_xs, y_:ys})
            if i%100==0:
                print(&quot;After %d training steps, loss on training batch is %g.&quot;%(step, loss_value))
                saver.save(sess, os.path.join(MODEL_SAVE_PATH, MODEL_NAME), global_step=global_step)

def main():
    mnist = input_data.read_data_sets('./data/', one_hot=True)
    backward(mnist)

if __name__=='__main__':
    main()
</code></pre>
<ul>
<li>mnist_lenet5_test.py</li>
</ul>
<pre><code class="language-python"># -*- coding: utf-8 -*-
&quot;&quot;&quot;
Created on Mon Feb 17 09:16:06 2020

@author: y1064
&quot;&quot;&quot;
import time
import tensorflow as tf
from tensorflow.examples.tutorials.mnist import input_data
import mnist_lenet5_forward
import mnist_lenet5_backward
import os
import numpy as np

TEST_INTERVAL_SECS = 5

def test(mnist):
    with tf.Graph().as_default() as g:
        x = tf.placeholder(tf.float32, [
                mnist.test.num_examples,
                mnist_lenet5_forward.IMAGE_SIZE,
                mnist_lenet5_forward.IMAGE_SIZE,
                mnist_lenet5_forward.NUM_CHANNELS
                ])
        y_ = tf.placeholder(tf.float32, 
                            [None, mnist_lenet5_forward.OUTPUT_NODE])
        y = mnist_lenet5_forward.forward(x, False, None)
        
        ema = tf.train.ExponentialMovingAverage(
                mnist_lenet5_backward.MOVING_AVERAGE_DECAY)
        ema_restore = ema.variables_to_restore()
        saver = tf.train.Saver(ema_restore)
        
        correct_prediction = tf.equal(tf.argmax(y, 1), tf.argmax(y_,1))
        accuracy = tf.reduce_mean(tf.cast(correct_prediction, tf.float32))
        
        while True:
            with tf.Session() as sess:
                ckpt = tf.train.get_checkpoint_state(mnist_lenet5_backward.MODEL_SAVE_PATH)
                if ckpt and ckpt.model_checkpoint_path:
                    saver.restore(sess, ckpt.model_checkpoint_path)
                    
                    global_step = ckpt.model_checkpoint_path.split('/')[-1].split(' ')[-1]
                    reshaped_x = np.reshape(mnist.test.images, (
                            mnist.test.num_examples,
                            mnist_lenet5_forward.IMAGE_SIZE,
                            mnist_lenet5_forward.IMAGE_SIZE,
                            mnist_lenet5_forward.NUM_CHANNELS
                            ))
                    accuracy_score = sess.run(accuracy, feed_dict = {
                            x:reshaped_x,
                            y_:mnist.test.labels
                            })
                    print('After %s training steps, test accuracy=%g'%(global_step, accuracy_score))
                else:
                    print('No checkpoint file found')
            
            time.sleep(TEST_INTERVAL_SECS)

def main():
    mnist = input_data.read_data_sets('./data/', one_hot=True)
    test(mnist)
    
if __name__=='__main__':
    main()
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[搜索算法]]></title>
        <id>https://YI-Pengfei.github.io/post/sou-suo-suan-fa/</id>
        <link href="https://YI-Pengfei.github.io/post/sou-suo-suan-fa/">
        </link>
        <updated>2020-02-16T04:20:38.000Z</updated>
        <content type="html"><![CDATA[<h3 id="bfs">BFS</h3>
<p>按层扩展<br>
<img src="https://YI-Pengfei.github.io/post-images/1581826896242.gif" alt="BFS示意图" loading="lazy"><br>
<img src="https://YI-Pengfei.github.io/post-images/1582596932039.png" alt="BFS-按深度层序的" loading="lazy"></p>
<h4 id="bfs基本代码">BFS基本代码：</h4>
<pre><code class="language-python">import networkx as nx

G = nx.Graph()
G.add_edge(1,2)
G.add_edge(2,4)
G.add_edge(2,3)
G.add_edge(3,5)

def bfs(G,node):
    res = []
    visited = {}
    for node in G.nodes(): # 标记所有节点为 &quot;未访问&quot;
        visited[node] = False
    queue = [node]
    visited[node] = True
    while queue:
        cur_node = queue.pop(0) # 队头出列
        res.append(cur_node)
        for child in nx.neighbors(G, cur_node):
            if not visited[child]:
                visited[child]=True
                queue.append(child) # 入队尾
    return res

print(bfs(G,5))
</code></pre>
<h4 id="bfs搜索od之间的路径">BFS搜索OD之间的路径</h4>
<figure data-type="image" tabindex="1"><img src="https://YI-Pengfei.github.io/post-images/1582547464448.png" alt="有向图示例" loading="lazy"></figure>
<pre><code class="language-python">&quot;&quot;&quot;
BFS找源到目的的路径 从S到E的路径:BFS一定能找到路径，但是不一定是最短路径长度，而是最小深度
&quot;&quot;&quot;
import networkx as nx

G = nx.DiGraph()
G.add_edge('S','A',weight=2)
G.add_edge('S','B',weight=1)
G.add_edge('S','C',weight=6)

G.add_edge('A','D',weight=6)
G.add_edge('A','E',weight=20)

G.add_edge('B','E',weight=20)
G.add_edge('CA','E',weight=8)

def BFS(G,O,D):
    &quot;&quot;&quot;
    G:有向图，O:源节点，D:目的节点
    &quot;&quot;&quot;
    record = {} ## 记录每一个节点的父节点
    queue = [O]
    print('root node is:', O)
    found=False  ## 
    while not found:
        if not queue:
            break
        cur_node = queue.pop(0) # 弹出队列第一个元素
        for child in G.neighbors(cur_node):
            print(child)
            record[child]=cur_node
            queue.append(child)
            if child==D:
                found=True
    
    if not D in record:
        print('not found target node')
        return -1
    path = [] # 组装路径
    while D in record:
        path.insert(0,(record[D],D))
        D = record[D]
    
    return path

print(BFS(G, 'S', 'E')) # 
&gt;&gt; [('S', 'A'), ('A', 'E')]
</code></pre>
<h3 id="dfs">DFS</h3>
<p>按深度扩展<br>
<img src="https://YI-Pengfei.github.io/post-images/1582596960531.png" alt="DFS-不撞南墙不回头的" loading="lazy"></p>
<h4 id="dfs基本代码递归">DFS基本代码(递归)：</h4>
<pre><code class="language-python">import networkx as nx

G = nx.Graph()
G.add_edge(1,2)
G.add_edge(2,4)
G.add_edge(2,3)
G.add_edge(3,5)

def dfs(G,node,visited={},res=[]):
    if not visited: # first run, mark all as unvisited
        for node in G.nodes():
            visited[node]=False 
    res.append(node)
    visited[node] = True
    for child in nx.neighbors(G, node):
        if not visited[child]:
            res, visited = dfs(G,child,visited,res)
    return res, visited

res,visited = dfs(G,5,{},[])
</code></pre>
<h4 id="dfs搜索od之间的路径">DFS搜索OD之间的路径</h4>
<pre><code class="language-python">&quot;&quot;&quot;
DFS找源到目的的路径 从S到E的路径. 后进先出&quot;last-in,first out&quot;
非递归方法 取节点(不出栈)，找到一个未被访问过的子节点，标记为访问，并入栈，重复
&quot;&quot;&quot;
import networkx as nx

G = nx.DiGraph()
G.add_edge('S','A',weight=2)
G.add_edge('S','B',weight=1)
G.add_edge('S','C',weight=6)

G.add_edge('A','D',weight=6)
G.add_edge('A','E',weight=20)

G.add_edge('B','E',weight=20)
G.add_edge('CA','E',weight=8)


def DFS(G,O,D):
    queue = [O]
    found=False
    visited = set([O])
    record = {}
    while not found:
        if not queue:  ## 终止条件：队列为空
            break
        
        cur_node = queue[-1] ## 每次都从队尾取节点，往深了访问  &quot;last-in,first out&quot;
        print(cur_node)
        
        if len(list(G.neighbors(cur_node)))==0: # 当前节点是叶子节点(到头了)
            queue.pop(-1) # 栈中弹出该节点 （对该节点的DFS已经结束）
        else:
            sign_children_all_visited = True
            for child in G.neighbors(cur_node):
                if not child in visited: # 发现未被访问过的子节点
                    sign_children_all_visited = False
                    break
            if not sign_children_all_visited:
                visited.add(child) # 添加为已访问
                record[child] = cur_node
                queue.append(child)  # 入栈
            else: # 所有子节点都被访问过
                queue.pop(-1)
        ###### 设置访问到目的节点D就终止 ######
        if child==D:
            found=True
            
    ### 构造路径
    if not D in record:
        print('not found target node')
        return -1
    path = [] # 组装路径
    while D in record:
        path.insert(0,(record[D],D))
        D = record[D]
    
    return path

print(DFS(G, 'S', 'E'))
</code></pre>
<h3 id="dijkstra">Dijkstra</h3>
<p>按最小代价扩展</p>
<h4 id="dijkstra搜索od之间的路径">Dijkstra搜索OD之间的路径:</h4>
<figure data-type="image" tabindex="2"><img src="https://YI-Pengfei.github.io/post-images/1582596978367.png" alt="UCS-一致代价搜索-按花费的" loading="lazy"></figure>
<pre><code class="language-python"># -*- coding: utf-8 -*-
&quot;&quot;&quot;
Dijkstra找源到目的地的最短路径 UCS一致代价搜索 
一致代价搜索总是扩展路径消耗最小的节点N。N点的路径消耗等于前一节点N-1的路径消耗加上N-1到N节点的路径消耗。
通过将 更新的路径 入堆，确保每次取出来的都是最小的路径
&quot;&quot;&quot;
import networkx as nx
import heapq # 堆

G = nx.DiGraph()
G.add_edge('S','A',weight=2)
G.add_edge('S','B',weight=1)
G.add_edge('S','C',weight=6)

G.add_edge('A','D',weight=6)
G.add_edge('A','E',weight=20)

G.add_edge('B','E',weight=20)
G.add_edge('C','E',weight=8)


O='S'
D='D'
def Dijkstra(G, O, D):
    INF=10*10
    dict_sure = {}  ## 记录各个节点的最短路径长度
    dict_path = dict((node,[O]) for node in G) ## 记录路径
    dict_dis = dict((node,INF) for node in G)  ## 记录路径长度（初始化为无穷大）
    dict_dis[O] = 0
    
    heap = []
    heapq.heappush(heap, (0,O))

    while heap:
        dis, cur_node=heapq.heappop(heap)  ##未访问点中距离最小的点和对应的距离
        if cur_node in dict_sure: # 弹出的节点无效(保证是未访问的)
            continue
        dict_sure[cur_node] = dis ## 标记为确定
        path = dict_path[cur_node]
        ### 添加，遇到目的节点D则终止
        if D in dict_sure:
            break
        ###
        for child in G.neighbors(cur_node):
            dis_new = G[cur_node][child]['weight']+dis
            if child not in dict_sure and dict_dis[child]&gt;dis_new: # 路径长度变短了
                heapq.heappush(heap, (dis_new,child)) # 入栈
                dict_dis[child] = dis_new # 更新信息
                dict_path[child] = path+[child]
                
    path = dict_path[D]
    path = [(path[i],path[i+1]) for i in range(len(path)-1)]
    return path, dict_sure[D] # 返回路径，路径长度
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[机器学习笔记]]></title>
        <id>https://YI-Pengfei.github.io/post/ji-qi-xue-xi-bi-ji/</id>
        <link href="https://YI-Pengfei.github.io/post/ji-qi-xue-xi-bi-ji/">
        </link>
        <updated>2020-02-16T01:04:31.000Z</updated>
        <content type="html"><![CDATA[<h3 id="神经元">神经元</h3>
<p>神经网络的基本模型是神经元，神经元的基本模型就是数学中的乘、加运算：<br>
<img src="https://YI-Pengfei.github.io/post-images/1581815704630.png" alt="神经元" loading="lazy"></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi><mo>=</mo><msub><mi>x</mi><mn>1</mn></msub><msub><mi>w</mi><mn>1</mn></msub><mo>+</mo><msub><mi>x</mi><mn>2</mn></msub><msub><mi>w</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">y=x_1 w_1 + x_2 w_2
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<h3 id="神经网络">神经网络</h3>
<figure data-type="image" tabindex="1"><img src="https://YI-Pengfei.github.io/post-images/1581816066755.png" alt="两层的神经网络（一个隐藏层）" loading="lazy"></figure>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>a</mi><mrow><mo>(</mo><mn>1</mn><mo>)</mo></mrow></msup><mo>=</mo><mi>X</mi><msup><mi>W</mi><mrow><mo>(</mo><mn>1</mn><mo>)</mo></mrow></msup><mspace linebreak="newline"></mspace><mi>y</mi><mo>=</mo><msup><mi>a</mi><mrow><mo>(</mo><mn>1</mn><mo>)</mo></mrow></msup><msup><mi>W</mi><mrow><mo>(</mo><mn>2</mn><mo>)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">a^{(1)}=XW^{(1)} \\
y=a^{(1)}W^{(2)}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.938em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.938em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.938em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">2</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>更进一步地，过激活函数<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span></span></span></span>以提高表现力的神经元模型：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><munder><mo>∑</mo><mi>i</mi></munder><msub><mi>x</mi><mi>i</mi></msub><msub><mi>w</mi><mi>i</mi></msub><mo>+</mo><mi>b</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">f(\sum_i x_iw_i+b)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.327674em;vertical-align:-1.277669em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0500050000000003em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">b</span><span class="mclose">)</span></span></span></span></span></p>
<p>常用的激活函数有:</p>
<ul>
<li>relu</li>
<li>sigmoid</li>
<li>tanh</li>
</ul>
<h3 id="损失函数loss">损失函数loss</h3>
<p>计算得到的预测值<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span>与已知答案<span class='katex-error' title='ParseError: KaTeX parse error: Expected group after &#039;_&#039; at position 2: y_̲'>y_</span>的差距：</p>
<ul>
<li>均方误差MSE</li>
<li>自定义损失函数：根据问题的实际情况</li>
<li>交叉熵CE（Cross Entropy）</li>
</ul>
<p>反向传播训练中，以减小loss值为优化目标，有<strong>梯度下降</strong>，<strong>momentum优化器</strong>，<strong>adam优化器</strong>等优化方法。</p>
<h3 id="学习率">学习率</h3>
<p>决定每次参数更新的幅度。在训练过程中，参数的更新向着损失函数梯度下降的方向。参数更新的公式为：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>w</mi><mi>n</mi></msub><mo>−</mo><mi>l</mi><mi>e</mi><mi>a</mi><mi>r</mi><mi>n</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi mathvariant="normal">_</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi mathvariant="normal">Δ</mi></mrow><annotation encoding="application/x-tex">w_{n+1}=w_n-learning\_rate \Delta
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.00444em;vertical-align:-0.31em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">e</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">n</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord">Δ</span></span></span></span></span></p>
<ul>
<li>指数衰减学习率：<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>e</mi><mi>a</mi><mi>r</mi><mi>n</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi mathvariant="normal">_</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>e</mi><mo>=</mo><mi>L</mi><mi>E</mi><mi>A</mi><mi>R</mi><mi>N</mi><mi>I</mi><mi>N</mi><mi>G</mi><mi mathvariant="normal">_</mi><mi>R</mi><mi>A</mi><mi>T</mi><mi>E</mi><mi mathvariant="normal">_</mi><mi>B</mi><mi>A</mi><mi>S</mi><mi>E</mi><mo>∗</mo><mi>L</mi><mi>E</mi><mi>A</mi><mi>R</mi><mi>N</mi><mi>I</mi><mi>N</mi><mi>G</mi><mi mathvariant="normal">_</mi><mi>R</mi><mi>A</mi><mi>T</mi><mi>E</mi><mi mathvariant="normal">_</mi><mi>D</mi><mi>E</mi><mi>C</mi><mi>A</mi><mi>Y</mi><mo>∗</mo><mfrac><mrow><mi>g</mi><mi>l</mi><mi>o</mi><mi>b</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>s</mi><mi>t</mi><mi>e</mi><mi>p</mi></mrow><mrow><mi>L</mi><mi>E</mi><mi>A</mi><mi>R</mi><mi>N</mi><mi>I</mi><mi>N</mi><mi>G</mi><mi mathvariant="normal">_</mi><mi>R</mi><mi>A</mi><mi>T</mi><mi>E</mi><mi mathvariant="normal">_</mi><mi>B</mi><mi>A</mi><mi>T</mi><mi>C</mi><mi>H</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>I</mi><mi>Z</mi><mi>E</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">learning\_rate=LEARNING\_RATE\_BASE * LEARNING\_RATE\_DECAY * \frac{global\_step}{LEARNING\_RATE\_BATCH\_SIZE}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.00444em;vertical-align:-0.31em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">e</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">n</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.99333em;vertical-align:-0.31em;"></span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault">G</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.99333em;vertical-align:-0.31em;"></span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault">G</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.39044em;vertical-align:-0.996em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.39444em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault">G</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.6999999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">b</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.996em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
其中，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi><mi>E</mi><mi>A</mi><mi>R</mi><mi>N</mi><mi>I</mi><mi>N</mi><mi>G</mi><mi mathvariant="normal">_</mi><mi>R</mi><mi>A</mi><mi>T</mi><mi>E</mi><mi mathvariant="normal">_</mi><mi>B</mi><mi>A</mi><mi>S</mi><mi>E</mi></mrow><annotation encoding="application/x-tex">LEARNING\_RATE\_BASE</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.99333em;vertical-align:-0.31em;"></span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault">G</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span>为学习率初始值（如0.1），<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi><mi>E</mi><mi>A</mi><mi>R</mi><mi>N</mi><mi>I</mi><mi>N</mi><mi>G</mi><mi mathvariant="normal">_</mi><mi>R</mi><mi>A</mi><mi>T</mi><mi>E</mi><mi mathvariant="normal">_</mi><mi>D</mi><mi>E</mi><mi>C</mi><mi>A</mi><mi>Y</mi></mrow><annotation encoding="application/x-tex">LEARNING\_RATE\_DECAY</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.99333em;vertical-align:-0.31em;"></span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault">G</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span></span></span></span>为学习率衰减率（如0.99），<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>g</mi><mi>l</mi><mi>o</mi><mi>b</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>s</mi><mi>t</mi><mi>e</mi><mi>p</mi></mrow><annotation encoding="application/x-tex">global\_step</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.00444em;vertical-align:-0.31em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">b</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault">p</span></span></span></span>记录了当前训练轮数，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi><mi>E</mi><mi>A</mi><mi>R</mi><mi>N</mi><mi>I</mi><mi>N</mi><mi>G</mi><mi mathvariant="normal">_</mi><mi>R</mi><mi>A</mi><mi>T</mi><mi>E</mi><mi mathvariant="normal">_</mi><mi>B</mi><mi>A</mi><mi>T</mi><mi>C</mi><mi>H</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>I</mi><mi>Z</mi><mi>E</mi></mrow><annotation encoding="application/x-tex">LEARNING\_RATE\_BATCH\_SIZE</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.99333em;vertical-align:-0.31em;"></span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault">G</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span>表示喂入多少轮<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi><mi>A</mi><mi>T</mi><mi>C</mi><mi>H</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>I</mi><mi>Z</mi><mi>E</mi></mrow><annotation encoding="application/x-tex">BATCH\_SIZE</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.99333em;vertical-align:-0.31em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span>后，更新一次学习率(一般设为：<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">总</mi><mi mathvariant="normal">样</mi><mi mathvariant="normal">本</mi><mi mathvariant="normal">数</mi><mi mathvariant="normal">/</mi><mi>B</mi><mi>A</mi><mi>T</mi><mi>C</mi><mi>H</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>I</mi><mi>Z</mi><mi>E</mi></mrow><annotation encoding="application/x-tex">总样本数/BATCH\_SIZE</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.06em;vertical-align:-0.31em;"></span><span class="mord cjk_fallback">总</span><span class="mord cjk_fallback">样</span><span class="mord cjk_fallback">本</span><span class="mord cjk_fallback">数</span><span class="mord">/</span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span></span></span></span>)。</li>
</ul>
<h3 id="滑动平均">滑动平均</h3>
<p>记录一段时间内模型中所有参数<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span>和<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span></span></span></span>各自的平均值。利用滑动平均值可以增强模型的泛化能力。计算公式：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">影</mi><mi mathvariant="normal">子</mi><mo>=</mo><mi mathvariant="normal">衰</mi><mi mathvariant="normal">减</mi><mi mathvariant="normal">率</mi><mo>∗</mo><mi mathvariant="normal">影</mi><mi mathvariant="normal">子</mi><mo>+</mo><mo>(</mo><mn>1</mn><mo>−</mo><mi mathvariant="normal">衰</mi><mi mathvariant="normal">减</mi><mi mathvariant="normal">率</mi><mo>)</mo><mo>∗</mo><mi mathvariant="normal">参</mi><mi mathvariant="normal">数</mi></mrow><annotation encoding="application/x-tex">影子=衰减率*影子 + (1-衰减率)*参数
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mord cjk_fallback">影</span><span class="mord cjk_fallback">子</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.46528em;vertical-align:0em;"></span><span class="mord cjk_fallback">衰</span><span class="mord cjk_fallback">减</span><span class="mord cjk_fallback">率</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord cjk_fallback">影</span><span class="mord cjk_fallback">子</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">衰</span><span class="mord cjk_fallback">减</span><span class="mord cjk_fallback">率</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0em;vertical-align:0em;"></span><span class="mord cjk_fallback">参</span><span class="mord cjk_fallback">数</span></span></span></span></span></p>
<p>其中，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">衰</mi><mi mathvariant="normal">减</mi><mi mathvariant="normal">率</mi><mo>=</mo><mi>m</mi><mi>i</mi><mi>n</mi><mo>{</mo><mi>M</mi><mi>O</mi><mi>V</mi><mi>I</mi><mi>N</mi><mi>G</mi><mi mathvariant="normal">_</mi><mi>A</mi><mi>V</mi><mi>E</mi><mi>R</mi><mi>A</mi><mi>G</mi><mi>E</mi><mi mathvariant="normal">_</mi><mi>D</mi><mi>E</mi><mi>C</mi><mi>A</mi><mi>Y</mi><mo separator="true">,</mo><mfrac><mrow><mn>1</mn><mo>+</mo><mi mathvariant="normal">轮</mi><mi mathvariant="normal">数</mi></mrow><mrow><mn>10</mn><mo>+</mo><mi mathvariant="normal">轮</mi><mi mathvariant="normal">数</mi></mrow></mfrac><mo>}</mo></mrow><annotation encoding="application/x-tex">衰减率=min\{MOVING\_AVERAGE\_DECAY, \frac{1+轮数}{10+轮数}\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mord cjk_fallback">衰</span><span class="mord cjk_fallback">减</span><span class="mord cjk_fallback">率</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.2484389999999999em;vertical-align:-0.403331em;"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mopen">{</span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault">G</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">A</span><span class="mord mathdefault">G</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span><span class="mbin mtight">+</span><span class="mord cjk_fallback mtight">轮</span><span class="mord cjk_fallback mtight">数</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">+</span><span class="mord cjk_fallback mtight">轮</span><span class="mord cjk_fallback mtight">数</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.403331em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">}</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">影</mi><mi mathvariant="normal">子</mi><mi mathvariant="normal">初</mi><mi mathvariant="normal">值</mi><mo>=</mo><mi mathvariant="normal">参</mi><mi mathvariant="normal">数</mi><mi mathvariant="normal">初</mi><mi mathvariant="normal">值</mi></mrow><annotation encoding="application/x-tex">影子初值=参数初值</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mord cjk_fallback">影</span><span class="mord cjk_fallback">子</span><span class="mord cjk_fallback">初</span><span class="mord cjk_fallback">值</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0em;vertical-align:0em;"></span><span class="mord cjk_fallback">参</span><span class="mord cjk_fallback">数</span><span class="mord cjk_fallback">初</span><span class="mord cjk_fallback">值</span></span></span></span>。<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi><mi>O</mi><mi>V</mi><mi>I</mi><mi>N</mi><mi>G</mi><mi mathvariant="normal">_</mi><mi>A</mi><mi>V</mi><mi>E</mi><mi>R</mi><mi>A</mi><mi>G</mi><mi>E</mi><mi mathvariant="normal">_</mi><mi>D</mi><mi>E</mi><mi>C</mi><mi>A</mi><mi>Y</mi></mrow><annotation encoding="application/x-tex">MOVING\_AVERAGE\_DECAY</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.99333em;vertical-align:-0.31em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault">G</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">A</span><span class="mord mathdefault">G</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span></span></span></span>表示滑动平均衰减率，一般会赋接近1的值。</p>
<h3 id="正则化">正则化</h3>
<p>在损失函数中给每个参数<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span>加上权重，引入模型复杂度指标，从而抑制模型噪声，减小过拟合：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo>=</mo><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo>(</mo><mi>y</mi><mi mathvariant="normal">与</mi><mi>y</mi><mi mathvariant="normal">_</mi><mo>)</mo><mo>+</mo><mi>R</mi><mi>E</mi><mi>G</mi><mi>U</mi><mi>L</mi><mi>A</mi><mi>R</mi><mi>I</mi><mi>Z</mi><mi>E</mi><mi>R</mi><mo>∗</mo><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo>(</mo><mi>w</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">loss = loss(y与y\_) + REGULARIZER*loss(w)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.06em;vertical-align:-0.31em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord cjk_fallback">与</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault">G</span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mord mathdefault">L</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span></span></span></span></span></p>
<p>其中，第一项是预测结果与标准答案之前的差距（如交叉熵、均方误差）；第二项是正则化计算结果。</p>
<h2 id="卷积神经网络">卷积神经网络</h2>
<figure data-type="image" tabindex="2"><img src="https://YI-Pengfei.github.io/post-images/1581896531157.png" alt="LeNet-5" loading="lazy"></figure>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[北航论文记录]]></title>
        <id>https://YI-Pengfei.github.io/post/lun-wen-xiang-guan-wen-ti-ji-lu/</id>
        <link href="https://YI-Pengfei.github.io/post/lun-wen-xiang-guan-wen-ti-ji-lu/">
        </link>
        <updated>2020-02-15T05:00:50.000Z</updated>
        <content type="html"><![CDATA[<h3 id="肖振宇">肖振宇</h3>
<p>无人机组网，毫米波通信  Unmanned aerial vehicles (UAVs) ,  millimeter wave</p>
<ul>
<li>信道估计方法</li>
<li>波束赋形Beamforming</li>
<li>多目标路径规划问题--》无人机安全路径规划</li>
<li>无人机动态路由协议</li>
</ul>
<h3 id="徐桢">徐桢</h3>
<p>卫星网络，航空自组网</p>
<ul>
<li>卫星组网路由算法</li>
<li>平衡网络流</li>
<li>IP地址分配管理</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[fedora27下的OpenStreetMap离线地理编码服务器的搭建(Nominatim)]]></title>
        <id>https://YI-Pengfei.github.io/post/fedora27-xia-de-openstreetmap-chi-xian-di-li-bian-ma-fu-wu-qi-de-da-jian-nominatim/</id>
        <link href="https://YI-Pengfei.github.io/post/fedora27-xia-de-openstreetmap-chi-xian-di-li-bian-ma-fu-wu-qi-de-da-jian-nominatim/">
        </link>
        <updated>2020-02-14T00:56:09.000Z</updated>
        <content type="html"><![CDATA[<h1 id="前言">前言</h1>
<p>CSDN上有关于ubuntu如何安装Nominatim的博文<a href="https://blog.csdn.net/u013719339/article/details/53908990">ubuntu16.04下的OpenStreetMap离线地理编码服务器的搭建(Nominatim)</a>，但是作者尚未查询到中文的、关于fedora如何安装Nominatim的博文，甚至也未见英文的博文，这是本文写作的目的。</p>
<p><strong>可以参考的网站：</strong></p>
<ul>
<li>Nominatim官方文档<a href="https://nominatim.org/release-docs/develop/appendix/Install-on-Centos-7/">Installation on CentOS 7</a>，CentOS和Fedora还比较像，但是也有不同，最重要的就是fedora装的时候注意指定版本，版本，版本！！<br>
(fedora与ubuntu的软件目录，配置、启动方式有很大不同，参考ubuntu下的安装反而更容易混淆)<br>
本文是对于fedora27安装Nominatim的心得步骤，不同的系统、不同的系统版本是有差别的。我的建议是：<mark>注意软件版本，注意相互之间的依赖关系。先通读本文，掌握整个安装思路和重点，切记不顾实际光粘命令行。</mark></li>
</ul>
<p><ul class="markdownIt-TOC">
<li><a href="#%E5%89%8D%E8%A8%80">前言</a></li>
<li><a href="#%E4%B8%80-%E6%96%B0%E5%BB%BAfedora%E7%94%A8%E6%88%B7">一、新建Fedora用户</a></li>
<li><a href="#%E4%BA%8C-%E8%A3%85%E4%BE%9D%E8%B5%96%E8%BD%AF%E4%BB%B6">二、装依赖（软件）</a>
<ul>
<li><a href="#1%E4%B8%BB%E8%A6%81%E5%88%86%E4%B8%89%E5%A4%A7%E7%B1%BB">1）主要分三大类：</a></li>
<li><a href="#2%E5%AE%89%E8%A3%85%E5%91%BD%E4%BB%A4">2）安装命令：</a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E9%85%8D%E7%BD%AE%E5%92%8C%E5%90%AF%E5%8A%A8postgresql-10-fedora%E7%B3%BB%E7%BB%9F%E4%B8%8B">三、配置（和启动）postgresql 10 （Fedora系统下）</a>
<ul>
<li><a href="#1-%E5%88%9D%E5%A7%8B%E5%8C%96%E5%8F%8A%E5%90%AF%E5%8A%A8">1） 初始化及启动</a></li>
<li><a href="#2-%E9%85%8D%E7%BD%AEpostgresqlconf%E6%96%87%E4%BB%B6">2） 配置postgresql.conf文件</a></li>
<li><a href="#3-%E6%B7%BB%E5%8A%A0%E4%B8%A4%E4%B8%AApostgres%E7%94%A8%E6%88%B7">3) 添加两个postgres用户</a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E8%A3%85nominatim">四、装Nominatim</a>
<ul>
<li><a href="#1%E5%BB%BA%E6%96%87%E4%BB%B6%E5%A4%B9%E5%B9%B6%E6%94%B9%E6%9D%83%E9%99%90">1）建文件夹并改权限</a></li>
<li><a href="#2-%E4%B8%8B%E8%BD%BD-%E7%BC%96%E8%AF%91-%E5%AE%89%E8%A3%85nominatim">2) 下载、编译、安装Nominatim</a></li>
</ul>
</li>
<li><a href="#%E4%BA%94-%E9%85%8D%E7%BD%AEapache-webserver">五、配置Apache Webserver</a></li>
<li><a href="#%E5%85%AD-%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE">六、导入数据</a></li>
<li><a href="#%E6%80%BB%E7%BB%93">总结</a></li>
<li><a href="#%E9%99%84-%E6%9C%80%E5%90%8E%E7%9A%84%E6%95%88%E6%9E%9C">附、最后的效果</a></li>
</ul>
(目录)</p>
<h1 id="一-新建fedora用户">一、新建Fedora用户</h1>
<p>Nominatim很乱，先新建个用户，不然各种<strong>权限问题</strong>：</p>
<ul>
<li>图形化操作：设置--&gt;详情--&gt;用户--&gt;解锁--&gt;新建(账户类型选<strong>管理员</strong>，这样nominatim就跟你原来的账户权限一样)；</li>
<li>然后注销当前用户，切换到nominatim用户；</li>
<li><mark>以下所有操作都在nominatim这个账户下做的。</mark><br>
<img src="https://img-blog.csdn.net/20181019162710923?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0ZlbmdLdWFuZ1hpYW9adW8=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="图形化操作：设置--&gt;详情--&gt;用户--&gt;解锁--&gt;新建--&gt;管理员" height="400" loading="lazy"></li>
</ul>
<h1 id="二-装依赖软件">二、装依赖（软件）</h1>
<p><mark>这部分最重要！！！是后边成功配置的前提，不要光粘到命令行，先看一眼我说的是什么！！！！</mark><br>
官方<a href="https://blog.csdn.net/u013719339/article/details/53908990">CentOS的安装教程</a>没指定软件的版本，粘贴到fedora27中后，postgresql被不同的依赖项分别安装了两个版本（一个9.x，一个10），后边各种问题，崩溃。。所以重要的是<mark>版本，版本，版本！！！</mark></p>
<h2 id="1主要分三大类">1）主要分三大类：</h2>
<ol>
<li>postgresql类（分9.x版本的和10版本的，不同版本配置文件的位置不同，本文装的是10版本）</li>
<li>postgis类 （它的版本应该与postgresql的对应，如postgis25_10的意思就是postgis是2.5版本，支持postgresql 10，，，但实际证明postgis2.5版本不被Nominatim支持，本文最后选的postgis23_10）</li>
<li>php (没什么问题，不用指定版本，好像是7.1版本)</li>
</ol>
<h2 id="2安装命令">2）安装命令：</h2>
<ol>
<li>postgresql10相关：</li>
</ol>
<pre><code>sudo dnf install postgresql10 postgresql10-libs postgresql10-server postgresql10-contrib postgresql10-devel
</code></pre>
<ol start="2">
<li>postgis相关</li>
</ol>
<pre><code>sudo dnf install postgis23_10 postgis23_10-utils
</code></pre>
<ol start="3">
<li>php相关</li>
</ol>
<pre><code>sudo dnf install php php-pgsql php-pear php-pear-DB php-intl
</code></pre>
<ol start="4">
<li>其他</li>
</ol>
<pre><code>sudo dnf install libpqxx-devel proj-epsg bzip2-devel proj-devel libxml2-devel boost-devel \
                 wget git cmake make gcc gcc-c++ libtool policycoreutils-python \
                 expat-devel zlib-devel
</code></pre>
<p><strong>切记：不要好几个教程对着看，然后重复粘贴命令，软件都装重了！！然后各种问题，，，上边列出来的软件如果都装好了，应该就够了，</strong>（我之前一直处理openstreetmap的.pbf数据，所以与.pbf数据相关的库早就装好了，读者要是知道openstreetmap但还不知道.pbf数据，那你得下点功夫了，本文就不扯怎么装.pbf相关的库了）</p>
<h1 id="三-配置和启动postgresql-10-fedora系统下">三、配置（和启动）postgresql 10 （Fedora系统下）</h1>
<p>千万<mark>不要参考</mark>：1. ubuntu中postgresql的配置和启动方式； 2. postgresql 9的配置和启动方式。！！！！不然各种乱（因为不同系统下文件路径不一样，而且9和10版本的文件路径也不一样）</p>
<h2 id="1-初始化及启动">1） 初始化及启动</h2>
<pre><code>sudo /usr/pgsql-10/bin/postgresql-10-setup initdb
</code></pre>
<pre><code>sudo systemctl enable postgresql-10.service
</code></pre>
<pre><code>sudo systemctl start postgresql-10.service
</code></pre>
<h2 id="2-配置postgresqlconf文件">2） 配置postgresql.conf文件</h2>
<p>启动管理员权限下的文本编辑器，编辑postgresql.conf文件</p>
<pre><code>sudo gedit /var/lib/pgsql/10/data/postgresql.conf
</code></pre>
<p>修改如下内容，括号中的值代表要修改成的值</p>
<pre><code>shared_buffers (2GB)
maintenance_work_mem (10GB)
work_mem (50MB)
effective_cache_size (24GB)
synchronous_commit = off
checkpoint_timeout = 10min
checkpoint_completion_target = 0.9
</code></pre>
<p>改完之后，重启服务:</p>
<pre><code>sudo systemctl restart postgresql-10.service
</code></pre>
<h2 id="3-添加两个postgres用户">3) 添加两个postgres用户</h2>
<p>老实说我也不明白为什么要添加这两个用户，但是注意：<br>
<em>这是postgres的用户，不是fedora操作系统的用户！！！！ 意思好像是数据库中的用户？？？</em><br>
（我刚开始卡了很长很长时间，到后来反正也还没明白，苦笑）</p>
<ul>
<li>先用命令进入postgres用户 （很绕，我也讲不太清楚这块，好像是因为安装postgresql后自动出来的一个postgres用户，但它只能做特定的数据库相关的事）</li>
</ul>
<pre><code>su - postgres
</code></pre>
<p>(这块新读者可能容易出问题，密码输入的是nominatim用户的密码)</p>
<ul>
<li>运行如下命令，新建两个postgres用户：</li>
</ul>
<pre><code>createuser -s nominatim
createuser apache
</code></pre>
<ul>
<li>然后退回nominatim账户</li>
</ul>
<pre><code>exit
</code></pre>
<p>如图（我的都创建过了，所以提示失败）<br>
<img src="https://img-blog.csdn.net/20181019172207974?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0ZlbmdLdWFuZ1hpYW9adW8=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="在这里插入图片描述" height="250" loading="lazy"></p>
<h1 id="四-装nominatim">四、装Nominatim</h1>
<p>本文将nominatim安装在<code>/opt/nominatim</code>文件夹下（注意官方<a href="https://blog.csdn.net/u013719339/article/details/53908990">CentOS的安装教程</a>是在<code>/srv/nominatim</code>，并将它定义成了<code>$USERHOME</code>，本文少定义，省的混。。读者就跟我装一个路径吧，过程理清了之后想换也方便，，不然后边的配置讲不清楚）</p>
<h2 id="1建文件夹并改权限">1）建文件夹并改权限</h2>
<pre><code>sudo mkdir /opt/nominatim
</code></pre>
<pre><code>sudo chmod 777 -R /opt/nominatim
</code></pre>
<h2 id="2-下载-编译-安装nominatim">2) 下载、编译、安装Nominatim</h2>
<ul>
<li><a href="https://github.com/openstreetmap/Nominatim">官网github</a>上下载(截止到我下载的时候是3.20版本)，并移动到<code>/opt/nominatim</code>目录下，解压缩......之后应该是我这样的（还没有<code>build</code>文件夹）<br>
<img src="https://img-blog.csdn.net/2018101917375673?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0ZlbmdLdWFuZ1hpYW9adW8=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="在这里插入图片描述" height="150" loading="lazy"></li>
<li>先进入<code>Nominatim</code>文件夹里，运行命令<code>wget -O data/country_osm_grid.sql.gz https://www.nominatim.org/data/country_grid.sql.gz</code>下载国家网格(country grid)数据<br>
<img src="https://img-blog.csdn.net/20181019174142809?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0ZlbmdLdWFuZ1hpYW9adW8=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="在这里插入图片描述" loading="lazy"></li>
<li>退回来，新建<code>build</code>文件夹，进入<code>build</code>文件夹，cmake，然后make</li>
</ul>
<pre><code>cd /opt/nominatim
mkdir build
cd build
cmake /opt/nominatim/Nominatim
make
</code></pre>
<p>(<em>在这个目录下进行cmake和make</em>)<br>
<img src="https://img-blog.csdn.net/20181019174830163?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0ZlbmdLdWFuZ1hpYW9adW8=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="在这里插入图片描述" loading="lazy"></p>
<ul>
<li>还在<code>build</code>文件夹内，配置<code>settings/local.php</code>文件(即<code>/opt/nominatim/build/settings/local.php</code>)，内容如下(没有就新建)：</li>
</ul>
<pre><code>&lt;?php
 // Paths
 @define('CONST_Postgresql_Version', '10.5');  //这个是参照ubuntu安装的那篇的配置文件添加的，好像没有也行
 @define('CONST_Postgis_Version', '2.3');  // 好像没有也行
 //web set
 @define('CONST_Database_Web_User', 'apache');
 @define('CONST_Website_BaseURL', '/nominatim/');
 @define('CONST_Osm2pgsql_Flatnode_File', '/opt/nominatim/build/flatnode.file'); // 这是官方推荐添加的（非必须）
</code></pre>
<p><mark>如果cmake或make不成功，多半是因为前边的postgresql和postgis没装好（只是没装好，还不涉及配置的问题）。。。没更好的办法，按提示去网上查根本特么没有什么答案。。把装了的软件重新卸了，重装，重配置，等你到了不用看教程也大致明白哪里重要的时候，就能装好了</mark></p>
<h1 id="五-配置apache-webserver">五、配置Apache Webserver</h1>
<ul>
<li>配置文件为 <code>/etc/httpd/conf.d/nominatim.conf</code>（没有就新建），同样gedit打开，编辑内容如下：</li>
</ul>
<pre><code>&lt;Directory &quot;/opt/nominatim/build/website&quot;&gt;
  Options FollowSymLinks MultiViews
  AddType text/html   .php
  DirectoryIndex search.php
  Require all granted
&lt;/Directory&gt;
Alias /nominatim /opt/nominatim/build/website
</code></pre>
<p><em>这里<code>/opt/nominatim</code>就对应上一节Nominatim的位置。</em></p>
<ul>
<li>重新载入apache：</li>
</ul>
<pre><code>sudo systemctl enable httpd
sudo systemctl restart httpd
</code></pre>
<p>这时候你打开网址<a href="http://localhost/nominatim">http://localhost/nominatim</a>应该就可以看到一些内容了（文本内容，提示严重错误，没有nominatim数据库之类的，因为还没有导入数据嘛）</p>
<h1 id="六-导入数据">六、导入数据</h1>
<ul>
<li>（可选）下载额外的wiki数据，进入到<code>/opt/nominatim/Nominatim/data</code>目录下，运行命令：</li>
</ul>
<pre><code>wget https://www.nominatim.org/data/wikipedia_article.sql.bin
wget https://www.nominatim.org/data/wikipedia_redirect.sql.bin
</code></pre>
<ul>
<li>导入数据：<br>
openstreetmap数据可以在网站<a href="https://download.geofabrik.de/">https://download.geofabrik.de/</a>下载（读者应该知道吧）。导入命令（还在<code>/opt/nominatim/build</code>目录下呢）：</li>
</ul>
<pre><code>./utils/setup.php --osm-file &lt;data file&gt; --all [--osm2pgsql-cache 28000] 2&gt;&amp;1 | tee setup.log
</code></pre>
<p>里边<code>&lt;data file&gt;</code>替换为你的.pbf文件，<code>--osm2pgsql-cache 28000</code>是可选参数，一个实际的命令如图：<br>
<img src="https://img-blog.csdn.net/20181019181616197?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0ZlbmdLdWFuZ1hpYW9adW8=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="在这里插入图片描述" loading="lazy"><br>
要试一试有没有问题的话先选一个小点儿的数据，如北京的。同样地，<mark>如果导入不成功多半是因为前边的postgresql和postgis没装好</mark>，例如，我刚开始装的postgis25_10(2.5版本)，不被支持，提示: <strong>found postgis version 0</strong>(应该就是没找到的意思)，后来换了低版本的postgis23_10，导入成功了。 如果失败，再次导入之前要先删除数据库，命令：</p>
<pre><code>sudo -u postgresdropdb nominatim
</code></pre>
<h1 id="总结">总结</h1>
<p>本文给出的是Fedora27下安装Nominatim的基本方法，postgresql的版本为10，postgis的版本为2.3，php版本为7.1，Nominatim的版本为3.2。并给出了配置postgresql、apache、nominatim的方法。需要特别注意的是：安装软件过程中要指定软件版本，注意区分不同操作系统、不同软件版本的安装、配置上的差异。限于作者水平和应用场景，关于局域网的配置、更多额外辅助数据的添加、保持数据实时更新的方法未做讨论，这部分内容可以参考<a href="https://nominatim.org/release-docs/develop/">Nominatim官方文档</a>以及<a href="https://blog.csdn.net/u013719339/article/details/53908990">ubuntu16.04下的OpenStreetMap离线地理编码服务器的搭建(Nominatim)</a>。</p>
<h1 id="附-最后的效果">附、最后的效果</h1>
<p><img src="https://img-blog.csdn.net/20181019182036905?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0ZlbmdLdWFuZ1hpYW9adW8=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="在这里插入图片描述" loading="lazy"><br>
不联网也会有结果，但是可能网格图片显示有问题。。<br>
本人的是为了用python中的<code>geocoder</code>库离线使用地理编码功能，python代码如下：</p>
<pre><code>import geocoder 
url = 'http://localhost/nominatim'
g = geocoder.google('北京市北京站', url=url)
g.json
</code></pre>
]]></content>
    </entry>
</feed>